<?xml version="1.0" encoding="UTF-8"?>
<openerp>
    <data>
        <template id="xiao_wechat_stock.stock_list" name="Wechat Stock List">
            <t t-call="odoosoft_wechat_website.layout">
                <header class="ui-header ui-header-stable ui-border-b">
                    <h1>收发货列表</h1>
                </header>
                <section class="ui-container">
                    <ul class="ui-list ui-list-pure ui-border-tb ui-list-link">
                        <t t-foreach="result" t-as="picking">
                            <li class="ui-border-t picking-list" t-att-data-id="picking.id">
                                <div class="ui-row-flex ui-whitespace">
                                    <div class="ui-col ui-col-1 ui-txt-default">编号</div>
                                    <div class="ui-col ui-col-4 ui-nowrap ui-txt-info">
                                        <p t-field="picking.name"/>
                                    </div>
                                </div>
                                <div class="ui-row-flex ui-whitespace">
                                    <div class="ui-col ui-col-1 ui-txt-default">状态</div>
                                    <div class="ui-col ui-col ui-col-4 ui-txt-highlight">
                                        <p t-field="picking.state"/>
                                    </div>
                                </div>
                                <div class="ui-row-flex ui-whitespace">
                                    <div class="ui-col ui-col-1 ui-txt-default">客户</div>
                                    <div class="ui-col ui-col-4 ui-nowrap ui-txt-info">
                                        <p t-field="picking.partner_id.name"/>
                                    </div>
                                </div>

                                <div class="ui-row-flex ui-whitespace">
                                    <div class="ui-col ui-col-3 ui-txt-default">产品</div>
                                    <div class="ui-col ui-col-2 ui-txt-default">数量</div>
                                </div>
                                <div class="ui-row-flex ui-whitespace" t-foreach="picking.move_lines" t-as="line">
                                    <div class="ui-col ui-col-3 ui-txt-info">
                                        <p t-field="line.product_id.name"/>
                                    </div>
                                    <div class="ui-col ui-col-2 ui-txt-info">
                                        <p t-field="line.product_uom_qty"/>
                                    </div>
                                </div>
                            </li>
                        </t>
                    </ul>
                </section>
                <t t-set="footer">
                    <script>
                        $(function(){
                        var plist = $('.picking-list')
                        plist.bind('click',function(e){
                        e.preventDefault();
                        var id = this.dataset.id;
                        window.location.href = '/mobile/stock/scan/detail/<t t-esc="code"/>/'+id
                        });
                        });
                    </script>
                </t>
            </t>
        </template>

        <template id="xiao_wechat_stock.stock_form" name="Wechat Stock List">
            <t t-call="odoosoft_wechat_website.layout">

                <header class="ui-header ui-header-stable ui-border-b">
                    <h1 t-field="result.name"/>
                    <button class="ui-btn return-list">
                        <a t-att-href="'/mobile/stock/scan/list/'+code">返回列表</a>
                    </button>
                </header>
                <section class="ui-container">
                    <section>
                        <div class="ui-form ui-border-t">
                            <form action="#" class="data_form" t-att-data-id="result.id">
                                <div class="ui-form-item ui-form-item-show ui-border-b">
                                    <label>业务伙伴</label>
                                    <div class="ui-readonly-test" t-field="result.partner_id.name"/>
                                </div>
                                <t t-if="result.state in ['confirmed']">
                                    <div class="ui-form-item ui-form-item-l ui-border-b">
                                        <label class="ui-border-r check_state">
                                            检查状态
                                        </label>
                                        <div class="ui-readonly-test" t-field="result.state"/>
                                    </div>
                                </t>
                                <t t-if="result.state not in ['confirmed']">
                                    <div class="ui-form-item ui-form-item-show ui-border-b">
                                        <label class="ui-border-r">
                                            检查状态
                                        </label>
                                        <div class="ui-readonly-test" t-field="result.state"/>
                                    </div>
                                </t>
                                <div class="ui-form-item ui-form-item-show ui-border-b">
                                    <label>创建日期</label>
                                    <div class="ui-readonly-test" t-field="result.date"/>
                                </div>
                                <div class="ui-form-item ui-form-item-show ui-border-b">
                                    <label>安排日期</label>
                                    <div class="ui-readonly-test" t-field="result.min_date"/>
                                </div>
                                <div class="ui-form-item ui-form-item-show ui-border-b">
                                    <label>承运方</label>
                                    <div class="ui-readonly-test" t-field="result.carrier_id.name"/>
                                </div>
                                <div class="ui-form-item ui-form-item-l ui-border-b">
                                    <label class="ui-border-r scan-wechat">
                                        <a>扫描单号</a>
                                    </label>
                                    <input class="carrier_tracking_ref" type="text" t-att-value="result.carrier_tracking_ref"/>
                                    <a class="ui-icon-close carrier_tracking_ref_clear" href="#"/>
                                </div>
                            </form>
                        </div>
                    </section>
                    <section>
                        <div>
                            <table class="ui-table ui-border-tb">
                                <thead>
                                    <tr>
                                        <th>产品</th>
                                        <th>数量</th>
                                        <th>可用</th>
                                        <th>状态</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr t-foreach="result.move_lines" t-as="line">
                                        <td>
                                            <span t-field="line.product_id.name"/>
                                        </td>
                                        <td>
                                            <span t-field="line.product_uom_qty"/>
                                        </td>
                                        <td>
                                            <span t-field="line.string_availability_info"/>
                                        </td>
                                        <td>
                                            <span t-field="line.state"/>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </section>
                    <section>
                        <div class="ui-btn-wrap">
                            <button class="ui-btn-lg ui-btn-primary update_carrier_ref">
                                更新单号
                            </button>
                        </div>
                        <t t-if="result.state in ['assigned']">
                            <div class="ui-btn-wrap">
                                <button class="ui-btn-lg ui-btn-danger transfer_all">
                                    确认已收/发货
                                </button>
                            </div>
                        </t>
                    </section>
                </section>
                <t t-set="footer">
                    <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"/>
                    <script>
                        $(function(){
                        wx.config({
                        debug:<t t-esc="config.get('debug', false)"/>, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                        appId: '<t t-esc="config['corp_id']"/>', // 必填，公众号的唯一标识
                        timestamp: '<t t-esc="config['timestamp']"/>', // 必填，生成签名的时间戳
                        nonceStr: '<t t-esc="config['noncestr']"/>', // 必填，生成签名的随机串
                        signature: '<t t-esc="config['signature']"/>',// 必填，签名，见附录1
                        jsApiList: [
                        'scanQRCode',
                        ] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
                        });
                        });

                    </script>
                    <script src="/xiao_wechat_stock/static/src/js/stock_scan.js"/>
                </t>
            </t>
        </template>
    </data>
</openerp>